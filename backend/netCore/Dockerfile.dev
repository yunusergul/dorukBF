FROM mcr.microsoft.com/dotnet/sdk:8.0 AS dev

ARG BACKEND_PORT
ARG ASPNETCORE_ENVIRONMENT
ARG DOTNET_USE_POLLING_FILE_WATCHER
ARG DOTNET_WATCH_RESTART_ON_RUDE_EDIT
ARG ASPNETCORE_URLS

WORKDIR /app


COPY *.csproj ./
RUN dotnet restore

COPY . ./

# Set environment variables using ARG values
ENV ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
ENV DOTNET_USE_POLLING_FILE_WATCHER=${DOTNET_USE_POLLING_FILE_WATCHER}
ENV ASPNETCORE_URLS=${ASPNETCORE_URLS}
ENV DOTNET_WATCH_RESTART_ON_RUDE_EDIT=${DOTNET_WATCH_RESTART_ON_RUDE_EDIT}

EXPOSE ${BACKEND_PORT}

ENTRYPOINT ["sh", "-c", "dotnet watch run --urls \"${ASPNETCORE_URLS}\""]